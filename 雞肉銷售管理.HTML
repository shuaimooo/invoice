<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中盤商雞肉銷售管理系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f7f8fc;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block;
            }
            
            body {
                background-color: white;
            }
            
            .print-container {
                padding: 20px;
                max-width: 100% !important;
                margin: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50">
        <header class="bg-amber-700 text-white shadow-lg no-print">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold">雞肉銷售管理系統</h1>
                <div class="flex space-x-4">
                    <button id="newOrderBtn" class="bg-amber-600 hover:bg-amber-500 px-4 py-2 rounded-lg font-medium transition">新增訂單</button>
                    <button id="orderListBtn" class="bg-amber-600 hover:bg-amber-500 px-4 py-2 rounded-lg font-medium transition">訂單列表</button>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8">
            <!-- 訂單表單 -->
            <div id="orderForm" class="bg-white rounded-xl shadow-md p-6 mb-8 print-container">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-amber-800">銷售訂單</h2>
                    <div class="no-print">
                        <button id="printBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-medium transition">列印訂單</button>
                    </div>
                </div>

                <div class="print-only text-center mb-6">
                    <h1 class="text-2xl font-bold">優質雞肉批發</h1>
                    <p>電話：0926169899</p>
                    <p>聯絡人：蘇裕庭(小毛)</p>
                    <h2 class="text-xl font-bold mt-4">銷售單</h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">訂單編號</label>
                        <input type="text" id="orderNumber" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" readonly>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">日期</label>
                        <input type="date" id="orderDate" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">客戶名稱</label>
                        <input type="text" id="customerName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="請輸入客戶名稱">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-medium mb-2">聯絡電話</label>
                        <input type="text" id="customerPhone" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="請輸入聯絡電話">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 font-medium mb-2">送貨地址</label>
                        <input type="text" id="deliveryAddress" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" placeholder="請輸入送貨地址">
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-amber-800 mb-3">商品明細</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-amber-100">
                                    <th class="border border-amber-200 px-4 py-2 text-left">商品名稱</th>
                                    <th class="border border-amber-200 px-4 py-2 text-left">單價 (元/斤)</th>
                                    <th class="border border-amber-200 px-4 py-2 text-left">數量 (斤)</th>
                                    <th class="border border-amber-200 px-4 py-2 text-left">小計 (元)</th>
                                    <th class="border border-amber-200 px-4 py-2 text-left no-print">操作</th>
                                </tr>
                            </thead>
                            <tbody id="orderItems">
                                <!-- 商品列表將在這裡動態生成 -->
                            </tbody>
                        </table>
                    </div>
                    <button id="addItemBtn" class="mt-3 bg-amber-600 hover:bg-amber-500 text-white px-3 py-1 rounded-lg font-medium transition no-print">新增商品</button>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-start md:items-end">
                    <div class="mb-4 md:mb-0">
                        <label class="block text-gray-700 font-medium mb-2">備註</label>
                        <textarea id="orderNotes" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" rows="3" placeholder="請輸入備註事項"></textarea>
                    </div>
                    <div class="bg-amber-50 p-4 rounded-lg">
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">小計：</span>
                            <span id="subtotal">0</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="font-medium">稅額 (5%)：</span>
                            <span id="tax">0</span>
                        </div>
                        <div class="flex justify-between text-lg font-bold text-amber-800">
                            <span>總計：</span>
                            <span id="total">0</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex justify-between print-only">
                    <div>
                        <p>客戶簽名：_____________________</p>
                    </div>
                    <div>
                        <p>經手人：_____________________</p>
                    </div>
                </div>

                <div class="mt-8 text-center no-print">
                    <button id="saveOrderBtn" class="bg-green-600 hover:bg-green-500 text-white px-6 py-2 rounded-lg font-medium transition mr-4">儲存訂單</button>
                    <button id="resetFormBtn" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-2 rounded-lg font-medium transition">重置表單</button>
                </div>
            </div>

            <!-- 訂單列表 -->
            <div id="orderList" class="bg-white rounded-xl shadow-md p-6 hidden no-print">
                <h2 class="text-xl font-bold text-amber-800 mb-6">訂單列表</h2>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-amber-100">
                                <th class="border border-amber-200 px-4 py-2 text-left">訂單編號</th>
                                <th class="border border-amber-200 px-4 py-2 text-left">日期</th>
                                <th class="border border-amber-200 px-4 py-2 text-left">客戶名稱</th>
                                <th class="border border-amber-200 px-4 py-2 text-left">總金額</th>
                                <th class="border border-amber-200 px-4 py-2 text-left">操作</th>
                            </tr>
                        </thead>
                        <tbody id="orderListItems">
                            <!-- 訂單列表將在這裡動態生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer class="bg-amber-800 text-white py-4 mt-8 no-print">
            <div class="container mx-auto px-4 text-center">
                <p>© 2025 雞肉銷售管理系統 | 版權所有</p>
            </div>
        </footer>
    </div>

    <!-- 商品選擇模態框 -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden no-print">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-lg font-bold text-amber-800 mb-4">新增商品</h3>
            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">商品名稱</label>
                <select id="itemName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500">
                    <option value="">請選擇商品</option>
                    <option value="仿土雞">仿土雞</option>
                    <option value="烏骨雞">烏骨雞</option>
                    <option value="次雞">次雞</option>
                    <option value="熟雞整隻">熟雞整隻</option>
                    <option value="冷藏生雞">冷藏生雞</option>
                    <option value="冷凍全雞(真空包裝)">冷凍全雞(真空包裝)</option> 
                    <option value="客製商品">客製商品</option>
                </select>
                <input id="customItemName" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500 mt-2 hidden" placeholder="請輸入商品名稱">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 font-medium mb-2">單價 (元/斤)</label>
                <input type="number" id="itemPrice" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" min="0" step="0.1">
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 font-medium mb-2">數量 (斤)</label>
                <input type="number" id="itemQuantity" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500" min="0" step="0.1">
            </div>
            <div class="flex justify-end">
                <button id="cancelItemBtn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg font-medium transition mr-2">取消</button>
                <button id="confirmItemBtn" class="bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg font-medium transition">確認</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化變數
            let orders = JSON.parse(localStorage.getItem('chickenOrders')) || [];
            let currentItems = [];
            let editingItemIndex = -1;
            
            // 生成訂單編號
            function generateOrderNumber() {
                const date = new Date();
                const year = date.getFullYear().toString().substr(-2);
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `OR${year}${month}${day}${random}`;
            }
            
            // 設置今天日期
            document.getElementById('orderDate').valueAsDate = new Date();
            document.getElementById('orderNumber').value = generateOrderNumber();
            
            // 計算總金額
            function calculateTotal() {
                let subtotal = 0;
                currentItems.forEach(item => {
                    subtotal += item.price * item.quantity;
                });
                
                const tax = Math.round(subtotal * 0.05);
                const total = subtotal + tax;
                
                document.getElementById('subtotal').textContent = subtotal.toLocaleString() + ' 元';
                document.getElementById('tax').textContent = tax.toLocaleString() + ' 元';
                document.getElementById('total').textContent = total.toLocaleString() + ' 元';
                
                return { subtotal, tax, total };
            }
            
            // 渲染商品列表
            function renderItems() {
                const tbody = document.getElementById('orderItems');
                tbody.innerHTML = '';
                
                if (currentItems.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td colspan="5" class="border border-amber-200 px-4 py-2 text-center text-gray-500">尚未新增商品</td>`;
                    tbody.appendChild(tr);
                } else {
                    currentItems.forEach((item, index) => {
                        const tr = document.createElement('tr');
                        const subtotal = item.price * item.quantity;
                        
                        tr.innerHTML = `
                            <td class="border border-amber-200 px-4 py-2">${item.name}</td>
                            <td class="border border-amber-200 px-4 py-2">${item.price}</td>
                            <td class="border border-amber-200 px-4 py-2">${item.quantity}</td>
                            <td class="border border-amber-200 px-4 py-2">${subtotal.toLocaleString()} 元</td>
                            <td class="border border-amber-200 px-4 py-2 no-print">
                                <button class="edit-item bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1" data-index="${index}">編輯</button>
                                <button class="delete-item bg-red-600 hover:bg-red-500 text-white px-2 py-1 rounded text-sm" data-index="${index}">刪除</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
                calculateTotal();
            }
            
            // 渲染訂單列表
            function renderOrderList() {
                const tbody = document.getElementById('orderListItems');
                tbody.innerHTML = '';
                
                if (orders.length === 0) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td colspan="5" class="border border-amber-200 px-4 py-2 text-center text-gray-500">尚無訂單記錄</td>`;
                    tbody.appendChild(tr);
                } else {
                    orders.forEach((order, index) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="border border-amber-200 px-4 py-2">${order.orderNumber}</td>
                            <td class="border border-amber-200 px-4 py-2">${order.orderDate}</td>
                            <td class="border border-amber-200 px-4 py-2">${order.customerName}</td>
                            <td class="border border-amber-200 px-4 py-2">${order.total.toLocaleString()} 元</td>
                            <td class="border border-amber-200 px-4 py-2">
                                <button class="view-order bg-amber-600 hover:bg-amber-500 text-white px-2 py-1 rounded text-sm mr-1" data-index="${index}">查看</button>
                                <button class="delete-order bg-red-600 hover:bg-red-500 text-white px-2 py-1 rounded text-sm" data-index="${index}">刪除</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            }
            
            // 初始化頁面
            renderItems();
            
            // 新增商品按鈕
            document.getElementById('addItemBtn').addEventListener('click', function() {
                document.getElementById('itemModal').classList.remove('hidden');
                document.getElementById('itemName').value = '';
                document.getElementById('customItemName').value = '';
                document.getElementById('customItemName').classList.add('hidden');
                document.getElementById('itemPrice').value = '';
                document.getElementById('itemQuantity').value = '';
                editingItemIndex = -1;
            });
            
            // 商品選擇變更
            document.getElementById('itemName').addEventListener('change', function() {
                const customField = document.getElementById('customItemName');
                if (this.value === '客製商品') {
                    customField.classList.remove('hidden');
                } else {
                    customField.classList.add('hidden');
                }
            });
            
            // 取消新增商品
            document.getElementById('cancelItemBtn').addEventListener('click', function() {
                document.getElementById('itemModal').classList.add('hidden');
            });
            
            // 確認新增商品
            document.getElementById('confirmItemBtn').addEventListener('click', function() {
                const selectElement = document.getElementById('itemName');
                let itemName = selectElement.value;
                
                if (itemName === '客製商品') {
                    itemName = document.getElementById('customItemName').value;
                }
                
                const itemPrice = parseFloat(document.getElementById('itemPrice').value);
                const itemQuantity = parseFloat(document.getElementById('itemQuantity').value);
                
                if (!itemName || isNaN(itemPrice) || isNaN(itemQuantity)) {
                    alert('請填寫完整的商品資訊');
                    return;
                }
                
                const item = {
                    name: itemName,
                    price: itemPrice,
                    quantity: itemQuantity
                };
                
                if (editingItemIndex >= 0) {
                    currentItems[editingItemIndex] = item;
                } else {
                    currentItems.push(item);
                }
                
                document.getElementById('itemModal').classList.add('hidden');
                renderItems();
            });
            
            // 編輯和刪除商品
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-item')) {
                    const index = parseInt(e.target.dataset.index);
                    const item = currentItems[index];
                    
                    document.getElementById('itemModal').classList.remove('hidden');
                    
                    const selectElement = document.getElementById('itemName');
                    const customField = document.getElementById('customItemName');
                    
                    // 檢查是否為預設選項
                    let isDefaultOption = false;
                    for (let i = 0; i < selectElement.options.length; i++) {
                        if (selectElement.options[i].value === item.name) {
                            selectElement.value = item.name;
                            customField.classList.add('hidden');
                            isDefaultOption = true;
                            break;
                        }
                    }
                    
                    if (!isDefaultOption) {
                        selectElement.value = '客製商品';
                        customField.value = item.name;
                        customField.classList.remove('hidden');
                    }
                    
                    document.getElementById('itemPrice').value = item.price;
                    document.getElementById('itemQuantity').value = item.quantity;
                    editingItemIndex = index;
                }
                
                if (e.target.classList.contains('delete-item')) {
                    const index = parseInt(e.target.dataset.index);
                    if (confirm('確定要刪除此商品嗎？')) {
                        currentItems.splice(index, 1);
                        renderItems();
                    }
                }
                
                if (e.target.classList.contains('view-order')) {
                    const index = parseInt(e.target.dataset.index);
                    loadOrder(index);
                    showOrderForm();
                }
                
                if (e.target.classList.contains('delete-order')) {
                    const index = parseInt(e.target.dataset.index);
                    if (confirm('確定要刪除此訂單嗎？')) {
                        orders.splice(index, 1);
                        localStorage.setItem('chickenOrders', JSON.stringify(orders));
                        renderOrderList();
                    }
                }
            });
            
            // 儲存訂單
            document.getElementById('saveOrderBtn').addEventListener('click', function() {
                const orderNumber = document.getElementById('orderNumber').value;
                const orderDate = document.getElementById('orderDate').value;
                const customerName = document.getElementById('customerName').value;
                const customerPhone = document.getElementById('customerPhone').value;
                const deliveryAddress = document.getElementById('deliveryAddress').value;
                const orderNotes = document.getElementById('orderNotes').value;
                
                if (!customerName) {
                    alert('請填寫客戶名稱');
                    return;
                }
                
                if (currentItems.length === 0) {
                    alert('請至少新增一項商品');
                    return;
                }
                
                const { subtotal, tax, total } = calculateTotal();
                
                const order = {
                    orderNumber,
                    orderDate,
                    customerName,
                    customerPhone,
                    deliveryAddress,
                    items: [...currentItems],
                    notes: orderNotes,
                    subtotal,
                    tax,
                    total,
                    createdAt: new Date().toISOString()
                };
                
                // 檢查是否為編輯現有訂單
                const existingIndex = orders.findIndex(o => o.orderNumber === orderNumber);
                if (existingIndex >= 0) {
                    orders[existingIndex] = order;
                } else {
                    orders.push(order);
                }
                
                localStorage.setItem('chickenOrders', JSON.stringify(orders));
                alert('訂單已儲存');
                
                resetForm();
            });
            
            // 重置表單
            document.getElementById('resetFormBtn').addEventListener('click', function() {
                if (confirm('確定要重置表單嗎？所有未儲存的資料將會遺失。')) {
                    resetForm();
                }
            });
            
            function resetForm() {
                document.getElementById('orderNumber').value = generateOrderNumber();
                document.getElementById('orderDate').valueAsDate = new Date();
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                document.getElementById('deliveryAddress').value = '';
                document.getElementById('orderNotes').value = '';
                currentItems = [];
                renderItems();
            }
            
            // 列印訂單
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // 載入訂單
            function loadOrder(index) {
                const order = orders[index];
                document.getElementById('orderNumber').value = order.orderNumber;
                document.getElementById('orderDate').value = order.orderDate;
                document.getElementById('customerName').value = order.customerName;
                document.getElementById('customerPhone').value = order.customerPhone || '';
                document.getElementById('deliveryAddress').value = order.deliveryAddress || '';
                document.getElementById('orderNotes').value = order.notes || '';
                
                currentItems = [...order.items];
                renderItems();
            }
            
            // 切換頁面
            document.getElementById('newOrderBtn').addEventListener('click', showOrderForm);
            document.getElementById('orderListBtn').addEventListener('click', showOrderList);
            
            function showOrderForm() {
                document.getElementById('orderForm').classList.remove('hidden');
                document.getElementById('orderList').classList.add('hidden');
            }
            
            function showOrderList() {
                document.getElementById('orderForm').classList.add('hidden');
                document.getElementById('orderList').classList.remove('hidden');
                renderOrderList();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95237758a391f083',t:'MTc1MDM0MDcxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
